---
title: "From noise to knowledge: how randomness generates novel phenomena and reveals information"
author:
  - name: "Carl Boettiger"
    affiliation: a
    email: "cboettig@berkeley.edu"

address:
  - code: a
    address: "Dept of Environmental Science, Policy, and Management, University of California Berkeley, Berkeley CA 94720-3114, USA"

## Use trends style to quickly count refs
csl: trendsjournals.csl
#csl: ecology-letters.csl
bibliography: refs.bib
output: 
  rticles::elsevier_article:
    keep_tex: true
layout:  3p # review = doublespace, 3p = singlespace, 5p = two-column
preamble: |
  \newcommand{\ud}{\mathrm{d}}
  \usepackage[nomarkers]{endfloat}
  \journal{Ecology Letters}
  \linenumbers
  \usepackage{setspace}
  \doublespacing


abstract: |
  # Article Type: Review & Synthesis
  # Running title: Noise phenomena
  # Figures: 4
  # Tables: 0
  # Word count: 
  # Word count in abstract: 
  # Number of References: 
  # Archive statement:

  All data (simulated data and code) is made available on GitHub (<https://github.com/cboettig/noise-phenomena>), and if accepted, will be archived with provided DOI in an appropriate scientific data repositoriy.

  # Keywords: stochasticity, demographic noise, environmental noise, colored noise, quasi-cycles, tipping points

  \newpage 
    
  # Abstract
  
   Noise, as the term itself suggests, is most often seen a nuisance to ecological insight, a inconvenient reality that must be acknowledged, a haystack that must be stripped away to reveal the processes of interest underneath. Yet despite this well-earned reputation, noise is often interesting in its own right: noise can induce novel phenomena that could not be understood from some underlying determinstic model alone.  Nor is all noise the same, and close examination of differences in frequency, color or magnitude can reveal insights that would otherwise be inaccessible.  Yet with each aspect of stochasticity leading to some new or unexpected behavior, the time is right to move beyond the familiar refrain of "everything is important" [@Bjornstad2001].  Stochastic phenomena can suggest new ways of inferring process from pattern, and thus spark more dialog between theory and empirical perspectives that best advances the field as a whole. I highlight a few compelling examples, while observing that the study of stochastic phenomena are only beginning to make this translation into empirical inference.  There are rich opportunities at this interface in the years ahead.  
  


#keywords:
#  - stochasticity
#  - demographic noise
#  - environmental noise
#  - colored noise
#  - quasi-cycles
#  - tipping points

---

```{r libraries, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, dev="cairo_pdf", fig.width=7, fig.height=3.5, cache = TRUE)
library(tidyverse)
library(gridExtra)
library(ggthemes)
colours <- ptol_pal()(2)
```

```{r suggested_libs}
library(hrbrthemes)
library(extrafont)

##extrafont::font_import(prompt=FALSE)    # One-time use to set up fonts, can be slow.
hrbrthemes::import_roboto_condensed()   # One-time use to set up fonts 
extrafont::loadfonts()
ggplot2::theme_set(hrbrthemes::theme_ipsum_rc())
```


<!--
Directions:

We hope that these papers will combine a mix of synthetic reviews of the current state of an area, as well as insights into how the field has developed during the last twenty years, discussion of current important questions, and developments and insights that would significantly advance the field. Although certainly not necessary, if there are any past Ecology Letters papers that have had a profound impact on the development of an area – be it beneficial or not – a brief discussion of that impact would be appropriate. We also hope that articles will be written in a thoughtful style, but also provocative if appropriate.

-->


\newpage


# Introduction: Noise the nuisance

To the empricical ecologist, stochasticity, or more simply, "noise,"
is just that -- something which obscures patterns we are trying to infer [@Knape2011];
and an ever richer batteries of stastical methods are developed largely in an
attempt to strip away this undesirable randomness to reveal the patterns
beneath [@Coulson2001].  Over the past several decades, theoretical ecology has transitioned
from thinking of stochasticity in such terms; where noise is a nuciance
that obscures the "deterministic skeleton" of the underlying mechanisms,
to the recognition that stochasticity can itself be a mechanism for 
driving many interesting phenomena [@Coulson2004].  Yet this transistion from "noise the nuisance"
to "noise the creator" of ecological phenomena has had, with a few notable exceptions,
relatively little impact in empricial thinking about stochasticity.  One of the
most provocative of those exceptions has turned the classical notion of noise
the nuisance on its head: recognizing that noise driven phenomena can become a tool
to reveal underlying processes: to become "noise the informer."  Here I argue that
this third shift in perspective offers an opportunity to better bridge the divide
between respective primarily theoretical and primarily empricial communities by 
seeing noise not as mathematical curiousity or statistical bugbear, but as a
source for new opportunities for inference. 

As the literature on stochastic modeling in ecology is both extensive and often
technical, and so rather than attempt a comprehensive review, this synthesis
will focus on the simplest examples necessary to illustrate this broader trend
in the changing way we think about the role of noise and the opportunity
that shift can present to better bridge theoretical and empirical communities.
To that end, I will focus on examples from simple population models, echoing
the motivation of @Bartlett1960 to focus on basic theoretical aspects common
across models. In so doing, we will ignore the equally rich literature of 
stochastic models in evolution [@Lenormand2009] and population genetics
[e.g. @Ewens2004]. In an effort to make these themes accessible to more emprical
readers, I will also focus on simplest examples necessary, with only passing
mention of the rich literature extending these concepts to more realistic
models.  It is easy to critique this choice: indeed, one might summarize decades
of research in noting the twin observations that (1)  ecology is complex and (2)
that complexity is important. In the stochasticity literature alone, much work 
has been done to understand and extend fundamental results to more complex models,
including the importance of age and stage structure [e.g. @Cohen1979; @Tuljapurkar1989;
@Caswell2009; @Metcalf2015; @Vindenes2017b], spatial structure [e.g. @Durrett1994; @Dieckmann2000;
@Kerr2002; @Schreiber2010], Individual heterogeneity [e.g. @Vindenes2015; @Hart2016]
or the coexistence of multiple species [@Caswell1978; @Tuljapurkar1980; @Chesson1981;
@Chesson1982; @Chesson1985; @Chesson1989; @Melbourne2007; @Schreiber2017]; 
correlated [@Ripa; @Ripa1999; @Petchey, @Schreiber2010; @Lee2017; @Spanio2017] or periodic
[@Coulson2001; @Bjornstad2001; @Keeling2001] structure in environmental noise, or
the interaction of ecological and evolutionary processes [@Saether1997; @Ozgul2009;
@Lenormand2009; @Vindenes2015; @Schreiber2015]. In this we follow @Levins1966 in
sacrificing realism for generality.

In this spririt, I provide concise, detailed and commented
code for simulating each of the models presented in Appendix A.
Simulations permit poking and prodding of empirically-minded
investigation unencumbered by either experimental design or mathematical formalism.
Most stochastic models are expressed in the BUGS language, which
may be more familiar to empirical readers than corresponding
mathematical formulas. This also permits both efficient simulation
and potential estimation of parameters given sample data using the
R package, NIMBLE [@deValpine2017]; allowing the deductive models
illustrated here to readily function as inductive models with
parameters inferred from time-series data. A copy of this appendix
is maintained at <https://github.com/cboettig/noise-phenomena>, and
bug reports, suggestions or help requests are welcome through the
issue tracker.  Appendix B provides more mathematical details
for interested readers.  With these in place, we are ready to begin
our tour through three major areas of noisy phenomena: Origins of
noise, emergent phenomena, and noise-driven inference.


<!--
I approach this synthesis in three parts.  First, I will sketch the ground-work
for the origins of noise in any model as statistical summary of large number of
additional processes from some lower level that are modeled only in aggregate.
This will provide the fundamentals we need to illustrate several key examples
of noise driven phenomena in ecological dynamics: noise the creator.  Finally,
we will be able to invert some of these examples; instead of going from process
to pattern, we will go from pattern to process: noise the informer.  
-->




# Origins of noise

What is noise? Where does it come from?  Simply put, noise is all that we leave out of our model. 
Whenever stochasticity is introduced into a model, it
is only as a simplification or summary of the effects of a large
number of other processes, often occurring at different scales.
A central theme of stochastic modeling research over the past
several decades has been an emphasis on making this relationship
between stochasticity and underlying processes more precise:
that is, on the origins of noise [e.g. @Coulson2004]. This literature
has largely divided the origins of stochasticity between 
*intrinsic* factors: where stochasticity is introduced to reflect
the reality that our variables of interest are intriniscally 
statistical averages of lower-level processes, and *extrinsic*
factors: where stochasticity reflects the impact of other variables
we are not explicitly modeling at all [e.g. @Keeling2012].  **Demographic stochasticity**
is the primary (though not the only) example of an intrinsic factor,
which reflects the fact that the continuous variable we often think of a
"population size" or "population density" is an average over a 
lower level process of births and deaths among a finite number of 
individuals [@Melbourne2012].  **Environmental stochasticity** is the primary example 
of an extinsic factor, reflecting the fact that parameters we may
treat as constants in a model in fact depend on variables such as 
temperature or soil moisture that are not explicitly modeled by our 
equations, but simplified into statistical summaries of those processes
[@Ripa2012]. 

Many stochastic models are not explicit about whether the noise terms
they introduce are intended to reflect intrinsic or extrinsic factors.
Early quantitative ecological models first formulated at the population
level as differential or difference equations: deterministic models
that seek to capture the essential features of a system while
neglecting any random component as mere noise [@Coulson2004].
Advances in both theoretical understanding and the advent of widely
available and efficient numerical methods have helped drive research
towards increasingly more explicit descriptions of how stochasticity
enters into quantitative models. 




@Black2012 provides an important 
review of intrinsic noise and approaches for addressing it, focusing
in particular on use of the van Kampen system size expansion as a
mathematical means to properly bridge between individual-based models
(IBMs, usually implemented only in simulations) and familiar population-level
dynamics (so called macroscopic dynamics).  

; @Ovaskainen2010 the canonical on the highly influential @Leigh1981, @Lande1993, @Foley1994




This division between intrinsic or demographic noise and extrinsic or
environmental noise 


The Gillespie simulation provides a simple and exact algorithm
for simulating demographic stochasticity at an individual level.  
Free from both the approximations and mathematical complexity of more common
formulations using stochastic differential equations (SDEs), 
(or their partial differential equation counterparts the Fokker-Planck equation),
the Gillespie algorithm offers a simple and powerful approach to simulating
stochastic phenomena that remains underutilized. 

The mathematical proofs @Kurtz1970 & @Kurtz1971, popularized by
@vanKampen's intuitive "system size" expansion, provide a far more 
explicit framework to interpret demographic stochasticity than the
better known diffusion approximation [@Nisbet1982 @Lande2003; 
see @Gardiner2009].  





It is often suggested that stochasticity is "inherent" or "fundamental,"
e.g. "demographic stochasticity arises because the birth of an individual is probabilistic"
[@Melbourne2012]. It is easy to forget that this is merely an assertion about a 
model, not an assertion about reality [@Bartlett1960].  Only in quantum mechanics do we find 
inherently probabilistic properties: births and deaths of organisms all have
far more mechanistic explanations which we simply summarize in statistical terms:
on average -- that is, summing over a wide range of possible mechanisms we have chosen
not to explicitly model -- an individual death occurs at rate $\lambda$.  
This is in fact an extrinisic factor (variables not modeled explicitly),
which makes birth appear probabilistic; (just as we describe the toss of a coin
as probabilistic when in fact it is a mechanistic outcome of Newton's laws).  
Demographic stochasticity arises only subsequently, when we change scales from
a description at the individual level to one at the population level.






## Demographic stochasticity

Demographic stochasticity refers to fluctuations in population sizes
or densities that arise from the fundamentally discrete nature of
individual birth and death events.  Demographic stochasticity is a
particularly instructive case for illustrating a mechanism for how
noise arises as an aggregate description from a lower-level mechanistic
process.  We summarize the myriad lower-level processes that
mechanistically lead to the event of a 'birth' in the population
as a probability: In a population of $N$ identical individuals at
time $t$, a birth occurs with probability $b_t(N_t)$ (_i.e._ a rate
that can depend on the population size, $N$), which increases the
population size to $N+1$. Similarly, death events occur with probability
$d_t(N_t)$, decreasing the population size by one individual, to $N-1$.  Assuming
each of these events are independent, this is a state-dependent
Poisson process. The change in the probability of being in state
$N$ is given by the sum over the ways to enter the state, minus the
ways to leave the state: a simple expression of probability balance
known as the "master equation" [@vanKampen2007].

It is possible to simulate such a process exactly using Gillespie's
exact stochastic simulation algorithm [SSA; @Gillespie1977], which
simulates each individual birth or death as a separate event. 

We can illustrate both the Gillespie algorithm and the van Kampen
system size expansion using @Levins1969 classic patch model,

\begin{align}
\frac{\ud n}{\ud t} = \underbrace{c n \left(1 - \frac{n}{N}\right)}_{\textrm{birth}} - \underbrace{e n}_{\textrm{death}}, \label{levins}
\end{align}

where $n$ individuals compete for a
finite number of suitable habitats $N$.  Individuals die a constant
rate $e$, and produce offspring at a constant rate $c$ who then
have a probability of colonizing an open patch that is simply
proportional to the fraction of available patches, $1 - n/N$.  
We choose this model because it has precisely same functional form
as the ubiquitous logistic growth model, $\frac{\ud n}{\ud t} = rn (1 - \tfrac{n}{K})$
but is explicit about how this net growth rate is divided between
birth and death rate.  As we shall see, this is not merely a notational
convience but leads to real differences in observed stochastic properties
of the model.  Though we focus on this simple model for clarity of 
presentation, both computational and mathematical framework presented here 
can easily be applied to alternative models to reach the same conclusions.  


Figure \ref{gillespie}
uses this algorithm to compare simulations of @Levins1969 patch model;
(see Appendix A for example code).  In the Levins'  model,

Figure \ref{gillespie} shows the results of two exact SSA simulations of this model with
identical parameters except for the total number of available sites,
$N$.

<!-- Figure 1: Gillespie simulations -->
```{r gillespie, warning=FALSE, fig.width=7, fig.cap="Population dynamics from a Gillespie simulation of the Levins model with large (N=1000, panel A) and small (N=100, panel B) number of sites (blue) show relatively weaker effects of demographic noise in the bigger system. Models are otherwise identical, with e = 0.2 and c = 1 (code in appendix A). Theoretical predictions for mean and plus/minus one standard deviation shown in horizontal re dashed lines. \\label{gillespie}"}
read_csv("../appendixA/gillespie.csv", col_types = "cdiddd")  %>% 
  mutate(system_size = recode(system_size, large = "A. 1000 total sites", small= "B. 100 total sites")) %>%
  ggplot(aes(x = time)) + 
  geom_hline(aes(yintercept = mean), lty=2, col=colours[2]) + 
  geom_hline(aes(yintercept = minus_sd), lty=2, col=colours[2]) + 
  geom_hline(aes(yintercept = plus_sd), lty=2, col=colours[2]) + 
  geom_line(aes(y = n), col=colours[1]) +
  facet_wrap(~system_size, scales = "free_y") 
```


The van Kampen system size expansion provides a convenient way to
explicitly approximate the "macroscopic" (i.e. population level,
see @Black2012) dynamics from an individual-based description of
events in a Markov process [@vanKampen2007; based on @Kurtz1970;
@Kurtz1971].  In addition to illustrating how common stochastic
models (in particular, Gaussian noise) arise from lower-level
descriptions, this result will also provide us a useful framework
for interpreting the behavior of stochastic models more generally.
In Appendix B I illustrate the derivation of the following equations
for the mean and expected population sizes for a generic density
dependent birth-death process:

\begin{align}
\frac{\mathrm{d} x }{dt}  &= b(x) - d(x) + O(N^{-1})\\
\frac{\mathrm{d} \sigma^2 }{dt}  &= 2 \left( \partial_x b(x)  - \partial_x d(x) \right) \sigma^2 + b(x) + d(x) \label{bd}
\end{align}

where $x = \langle n \rangle$, the average or expected population
size of an ensemble of replicates, assuming the transitions (+/- 1
in this case) are much smaller than the system size ($N$ in the
Levins model).  The dynamics for the average population
match the population-level equation.^[up to fluctuations of order
$\tfrac{1}{N}$. We can actually both observe and successfully
approximate this higher-order correction from additional terms in
the system size expansion to recover the phenomenon of stochastic
inflation [@Gonzalez2002], where the average population size can
be larger or smaller than predicted by the deterministic model --
see Appendix A for examples in simulations compared to predictions
of the system size expansion].

The change in variance can be seen
as a balance between the stochastic contribution, $b(x) + d(x)$
and the deterministic contribution, $\partial_x \left(b(x) - d(x)\right)$. 
The deterministic contribution is the slope of the macroscopic
equation, that is, the eigenvalue indicating the stability of the
equilibrium point.  For stable points, this value must be negative
and precisely balance the strictly positive stochastic contribution 
of $b(x) + d(x)$ (the greater the rate of stochastic events involved, 
the greater the fluctuations).  This balance at steady-state is known as the
fluctuation-dissipation theorem [@vanKampen2007], an will prove a useful
expression in understanding stochastic dynamics.  Because Eq \eqref{bd}
also describes the time-evolution of these fluctuations, we can similarly
solve for the correlation between two points separated by time $\tau$.

For our Levins' model, $b(n) = n (1 - \tfrac{n}{N})$ and $d(n) = en$,
we find the average number of occupied patches 
$\langle n \rangle = N\tfrac{e}{c}$ with variance at steady-state of 
$\sigma^2_n = N \tfrac{e}{c}$.  Observe that the variance scales proportionally
to the system size, $N$, which explains the standard deviation
increases only as $\sqrt{N}$ while the steady state itself increases
in direct proportion to $N$, resulting in the smaller relative size
of fluctuations in the larger system in Figure \ref{gillespie}.  We can also see
that different ways of partitioning the same macroscopic equation
into components of birth and death will create the same mean dynamics
but with different levels of noise.  For instance, in a logistic
model with $b = rn$ and $d = rn^2/N$, we instead find the variance
at steady state is $\sigma^2 = K$; significantly larger than in the
Levins model.


## Environmental stochasticity

Whereas demographic noise reflects processes at a lower scale (the
individual, rather than the population), environmental stochasticity
reflects processes whose dynamics we are not explicitly modelling.
Once again, this can best be illustrated through an explicit
formulation of the master equation.  For a generic population model
that depends not only on population state $x$ but also on environmental
factors $y$, it is possible to derive the steady-state variance
(Appendix B) as:

\begin{equation}
\sigma_x^2  = \frac{ \left( \partial_y f(x,y) \right)^2}{\left( \partial_x f(x,y) \right)^2 + \partial_x f(x,y) \tau_c } \sigma_e^2 + \sigma^2_d \label{env_noise}
\end{equation}

where $\sigma_e^2$ is the variance in the environmental noise and
$\tau_c$ the auto-correlation of that noise, $\sigma_d^2$ the
equilibrium variance contributed by demographic noise from before,
($\tfrac{b + d}{-2\partial_x (b - d)}$) and where we have defined
$f(x,y) = b(x,y) - d(x,y)$ for notational convenience.  For example,
if extinction rate $e$ in our Levins' model is allowed to vary
stochastically as Gaussian white noise with variance $\sigma_e^2$
and mean $e$, we find the expected variance introduced in the
population to be:

$$\sigma_n^2 = \frac{e^2}{(c+e)^2} \sigma_e^2 + \frac{e}{c}N $$

Note that the contribution of environmental stochasticity is
independent of system size and directly proportional to the variance
in the environment.  This derivation provides a useful illustration
of the difference between demographic noise and environmental noise:
the latter simply describes the variation introduced by some other
dynamic variable that we are not modelling explicitly, and whose
dynamics are independent of the state of our system, $x$. This
environmental variation no doubt also arises from some more detailed
lower level process, but we need not be explicit about those dynamics
-- the expansion tells us that it is sufficient to know the overall
variance and the degree of auto-correlation.  Recent work has also
highlighted the importance of including both demographic and
environmental noise [@Melbourne2008; @Bonsall2004].  The system
size expansion still requires the assumption that the noise is small
relative to the system size.  In the case of large fluctuations,
this approximation must be replaced with a different approach, such
as the WKB approximation, as discussed in @Ovaskainen2010.

The importance of $\tau_c$, or the degree of auto-correlation, which
emerges from our derivation above, has also been and continues to be a subject of
significant interest in the study of stochastic population dynamics
[e.g.@Roughgarden; @Ellner; @Lawton; @Ripa1999; @Marshall2015].
Early work often assumed environmental noise would be
uncorrelated as a mathematical convenience.  As the derivation of
Eq \eqref{env_noise} makes clear, for a continuous-time process,
the relevant metric is the timescale of auto-correlation in the
environmental noise process relative to the auto-correlation timescale
of the population dynamics.  The Gaussian noise that emerges out
of the system-size approximation is always auto-correlated to some
degree -- if we measure our environment at consecutive times
infinitesimally far apart, we expect nearly identical values.  At
intervals much longer than the correlation time, consecutive
measurements are effectively independent (i.e. white noise). 
The degree of auto-correlation in  noise is all about _relative_ timescales.


## Other forms of stochasticity

Stochasticity frequently enters our models in other ways as well.
For instance, most population-level models treat all individuals
within the population, or at least within a particular age or stage
class, as identical.  *Individual heterogeneity* in relevant traits
(growth rates, dispersal ability) can be represented probabilistically
as a distribution rather than a fixed value, making it function as
another form of random variation in a model [@Coulson2001;
@Schreiber2010; @Vindenes2015].  *Spatial heterogeneity* can likewise be reflected
in stochastic parameters of a spatially implicit model, or as
spatially varying environmental stochasticity in a spatially explicit
model.  As with other forms of noise [@Melbourne2008; @Bonsall2004],
interaction between individual or spatial variation and other sources
of noise can drive patterns including the potential for persistence,
coexistence, and dispersal of species [@Schreiber2010; @Hart2016;
@Schreiber2017].  *Observational error* acts
much like another form of stochasticity, arising from sampling
effects or limitations of instruments, etc. Yet unlike the sources
described above, this uncertainty does not impact the actual state
of our system, and thus does not give rise to any additional phenomena
or information about that process, though it can obscure it
[@Knape2011; @deValpine2002].
*Deterministic chaos* [@Desharnais2001] is another mechanism of introducing
significant variation into a simple model. Chaos can a look a lot
like noise: indeed, it can be observationally indistinguishable
from a stochastic process [@Ellner2005; @Werndl2009].  Despite
substantial interest in previous decades and the relative ease of
encountering chaos in simple ecological models (particularly in
differences equations), and convincing reconstructions of chaotic
dynamics in laboratory manipulations [@Costantino1997] the prevalence
of chaotic dynamics as a driving factor in most ecological systems
remains unclear. After all, the great variation of natural populations
is hardly surprising: the undeniable influences of variation created
by all those things left out of our models, all that individual
detail from intrinsic, lower level processes and external environmental
processes that becomes aggregated in our simple models all but begs
for a stochastic description.


# Noise the creator: Noise can induce novel phenomena

Stochasticity can give rise to a wide array of interesting phenomena
that are often at odds with our intuition. As these examples will
illustrate, such behavior arises through an interaction between
stochastic and non-linear elements of a system, underscoring the
importance of explicitly including stochasticity in ecological
models [@Coulson2004; @Higgins1997].  Importantly, the noise itself
does not have to be large to give rise to these phenomena.  In this
section, I highlight several examples that have shown up frequently
in the literature and prove sufficiently tractable to provide a
simple intuition for the mechanisms involved.

## Persistence and coexistence  

The loss of a species is without a doubt one of the most important
possible consequences of noise, and unsurprisingly few topics have
recieved greater attention then the question of the persistence of
a given species [e.g. @Kendall1949;  @Bartlett1955; @Bartlett1960;
@Lande1993; @Saether1998; @Coulson2001; @Schreiber2010] and coexistence
of multiple species [@Caswell1978; @Tuljapurkar1980; @Chesson1981;
@Chesson1982; @Chesson1985; @Chesson1989; @Melbourne2007; @Hart2016; @Schreiber2017]
in stochastic models.  Two important trends in this literature have
been establishing existing results in more general and precise language
and theorems [e.g. see @Schreiber2012 and @Schreiber2017 for an excellent
overview and synthesis of persistence and coexistence respectively],
and continuing to extend such results to more complex contexts 
[@Ovaskainen2010 provides one excellent review], in
particular addressing autocorrelated noise [e.g. @Ripa; @Ripa1999; 
@Petchey, @Schreiber2010; @Lee2017; @Spanio2017] , spatial structure
[e.g. @Durrett1994; @Dieckmann2000; @Kerr2002; @Schreiber2010] and stage structure
[e.g. @Cohen1979; @Tuljapurkar1989; @Caswell2009; @Metcalf2015; @Vindenes2017b], 
among other issues.

Demographic noise in particular has fundamental implications for the long-term
equilibrium: any finite population, however big, is guaranteed to
eventually go extinct under demographic noise [e.g. @Kendall1949; @Lande2003].  
In most models it is possible [@Schreiber2006] to define a notion of quasi-stationary 
distribution concentrated around the deterministic attractor,
and to prove the probability of extinction decreases exponentially with 
system size [@Ovaskainen2010; @Schreiber2017]. We will turn our attention
away from the well-trodden ground of persistence and coexistence to focus
on other phenomena that 



here we will focus on a few examples of stochastic phenomena 
that can emerge on shorter time scales and provide some intuition for 
how the interaction between stochastic an nonlinear dynamics can 
create these surprising results.  

<!--

Insufficient space left for any treatment of these...
Permenance, robust permenance

**Bet hedging**, Lewontin & Cohen 1969; Levins 1969; 

-->


<!-- Figure 2: Quasi-cycles -->
```{r quasicycles, fig.width=7, fig.cap="Panel A: under negligible environmental noise, the introduction of a carrying capacity damps Lotka-Volterra oscillations which eventually settle to a stable state.  Panel B: small noise induces quasi-cycles in the same model: sustained long-term oscillations predominately around the natural frequency of the original damped oscillations. Parameters for models shown are r = .1, K = 5,  b = .1, c = .1, d = .1, N = 800; code in Appendix A. \\label{quasicycles}"}
read_csv("../appendixA/quasicycles.csv") %>%
  gather(species, population, -t, -sigma) %>%
  mutate(sigma = as.factor(sigma)) %>%
  mutate(sigma = recode(sigma, "1e-05" = "A.", "0.01" = "B.")) %>%
  rename(time = t) %>%
  ggplot(aes(time, population, col = species)) + geom_line() + 
  facet_wrap(~ sigma, ncol=2) + scale_color_ptol() 
```


## Quasi-cycles 

<!--  -->

Understanding the origin of sustained oscillations has long been a
central question in ecology [@Hastings1996; @Bjornstad2001].  The
simple Lotka Volterra model produces only neutrally stable centers,
while the more realistic model that introduces carrying capacity
for prey as they compete for resources results in a model that
produces only damped oscillations, eventually settling into a stable
state (Figure \ref{quasicycles}A).  However, the introduction of relatively small
noise into the system can be sufficient to excite the system into
sustained oscillations (Figure \ref{quasicycles}B) 
[e.g. empirical examples in @Blarer1999; @Greenman2003; @Black2010].  
In the example shown here, a
simple predator-prey system is driven by environmental white noise
$\xi_t$, with prey following the equation:

$$x_{t+1} = x_t + x_t r \left(1 - \frac{x_t}{K}\right) - b x_t  y_t + \xi_{x,t}$$
where $x_t$ is the prey density at time $t$, $r$ the growth rate, $K$ the carrying capacity, $b$ an encounter rate with the predator $y$, who obeys the equation:

$$y_{t+1} = y_t + c  x_t  y_t - d  y_t+ \xi_{y,t} $$
with $c$ the conversion ratio and $d$ the predator mortality rate.  Here we have assumed for the prey, $\xi_x \sim \mathcal{N(0, \sigma_x)}$, and similarly for the predator driven by $\xi_y$. Figure \ref{quasicycles}A shows examples for noise $\sigma_x = \sigma_y = 10^{-5}$, while Figure \ref{quasicycles}B shows $\sigma_x = \sigma_y = 0.01$.  



Oscillations arise through the process of stochastic resonance.
The damped oscillations seen in Figure \ref{quasicycles}A are analgous to a child
sitting still on a swing: friction slowly damps the magnitude of
each successive oscillation, while the period of pendulum remains
unchanged.  Driving the pendulum through perturbations timed to
match that natural period can quickly create sustained oscillations
with large magnitudes, but such perfect timing is not required.  In
the model above, white noise effectively drives the pendulum at all
frequencies, though at very low magnitude, since the noise is small
relative to the scale of the dynamics.  However, frequencies that
most closely match the natural period of the damped oscillator are
amplified, resonating with the natural oscillations.  This process
is sufficient to permit even small noise to drive sustained
oscillations in the model indefinitely.  The power spectrum (the
squared norm of the Fourier transform, a measure of what frequencies
are present; see, e.g. @Black2012) provides a convenient way to
visualize the effects of these oscillations.  The power spectrum
for a deterministic limit cycle would create a perfect sinusoidal
oscillation and a resulting power spectrum of a delta spike at that
single frequency.  The power spectrum for the quasi-cycle instead
shows a distribution of frequencies, centered at the the resonant
frequency of the damped oscillator.

Early work by @Blarer1999 identified quasi-cycles as a possible
explanation for oscillations and periodic outbreaks in pest ecosystems.
@Bjornstad2004 analyzes the potential for such stochastic effects
to drive cyclic behavior in population abundances of Atlantic bluefin
tuna and Atlantic Cod, while @Black2010 illustrates the use of
power-spectrum approaches to examine the behavior of quasi-cycles
in common disease outbreak models, focusing on a case where noise
arises explicitly from demographic stochasticity, rather than generic
environmental noise as in the model above and elsewhere [@Kendall1999; @Pascual2003].  
@Pineda-Krch2007 compare patterns from these stochastically generated cycles to
stable limit cycles they resemble.  Stochastic resonance highlights
one way in which even small noise can play an important role in
driving large scale patterns where we had previously only sought
deterministic explanations. This example also illustrates the
interplay between nonlinear dynamics and stochasticity that is the
hallmark of stochastically driven phenomena.  A stable node with
linear dynamics, such as an Ornstein-Uhlenbeck process, has no
resonant frequency, and could not produce sustained oscillations
(unless the environmental driver itself had a periodic pattern)
[e.g. @Gardiner2009; @Black2010].

<!-- See additional citations in Coulson2004 and others that mention stochastic resonance --> 
<!-- [@Keeling2001; @Coulson2004;]  -->

## Stochastic switching

We turn from stochastic resonance to oscillations of a very different
sort, which do not resemble any deterministic process, as seen in
Figure \ref{noisy_switch}A.  This pattern is characterized by long stretches during
which fluctuations in the state variable remain concentrated around
a high average value followed by sudden, rapid transitions into
fluctuations concentrated around a lower value.  This behavior
arises through the interaction of stochasticity and alternative
stable state dynamics.  The simulation shown in Figure \ref{noisy_switch}A for the
is based on an resource consumption model first proposed by @May1977
as one of the early examples of the potential for alternative stable
state dynamics.  The resource grows according to a logistic growth
model and is consumed according to a Holling Type-III functional
response curve, to which I have simply introduced the addition of
environmental noise:

$$X_{t+1} = X_t + \underbrace{X_t r \left(1 -\frac{X_t}{K} \right)}_{\textrm{ growth, } g(X_t)}  - \underbrace{\frac{a X_t ^ Q}{X_t^ Q + H ^ Q}}_{\textrm{consumption, } c(X_t)} + \xi_t,$$

where $\xi_t$ is normally distributed environmental variation with
mean zero and standard deviation $\sigma$. Figure \ref{noisy_switch}B shows separate
curves corresponding the parts of the model describing vegetation
growth and vegetation consumption, using the same parameters as
shown in the simulation panel, 3A.  Equilibria exist whenever growth
balances consumption.  For the parameters shown, the S-shaped curve
of the Type-III consumption pattern crosses the quadratic curve of
logistic growth at four separate locations.  When growth is larger
than consumption before the crossing, and thus smaller after, the
point is stable, otherwise it is unstable.  Consequently, we can
see two stable points, in the neighborhood of $X_t \approx 1.2$ and
$X_t \approx 0.5$, closely matching the average fluctuations seen
in the simulation in 3A.  Stochastic fluctuations drive spontaneous
shifts between these alternative stable states.

The concept of a potential well, Figure \ref{noisy_switch}C, is often invoked when
describing the behavior of alternative stable states.  The curve
for the potential well, $U(x)$ is defined as the negative integral
of the population growth rate,

$$U(x) = -\int_0^x f(y) \textrm{d} y $$ 

where in our model $f(y)$ is vegetation growth minus consumption,
$f(y) = g(y) - c(y)$.  The motivation comes from physics, where $f$
is a force and $U$ the corresponding potential energy.  This suggests
a convenient analogy to gravity, often implied by drawing a ball
inside the curve and referring to this as a "ball-in-cup" diagram.
The potential function is particularly instructive for understanding
stochastic switching under small noise, as in our simulation in
Figure \ref{noisy_switch}, where it is straight-forward to show [e.g. @Feller;
@vanKampen2007] that the probability of a transition is proportional
to the exponential of the depth of the well from the lowest point to
the separation barrier, (a result that is familiar as Arrhenius law
of activation energy to grade-school students of chemistry).  This
effect is visible even in the short simulation shown in 3A, which
spends longer times in the lower state which has the deeper well.
(Readers are encouraged to experiment with this by adjusting the
parameters of the simulation in the included code).  Unfortunately,
the literature is not always careful in describing how this potential
well diagram arises, which has caused it to become a source for as
least as much confusion as it is of insight.  While the curves in
Figure \ref{noisy_switch}B can be clearly associated with underlying mechanisms of
rates: logistic growth and consumption with handling time, the same
is not true of the potential: it is much harder to have a good
intuition about the 'negative integral of the difference growth and
consumption,' and how it would change in response to, say, a larger
carrying capacity $K$ or higher consumption rate $a$.  While the
x-axis of the potential diagram remains the same: the system state,
the conceptual problem is clearly evident in the usual ambiguity
describing the y-axis in such ball-in-cup models.


<!--Figure \ref{noisy_switch}: Noisy switch -->
```{r noisy_switch, fig.width=7, fig.height=7, fig.cap="Stochastic switiching in May's model of alternative stable state dynamics.  r = .5, K = 2, Q = 5, H = .38, sigma = .04, a = 0.245, N = 10000. \\label{noisy_switch}"}

p <- list(r = .5, K = 2, Q = 5, H = .38, sigma = .04, a = 0.245, N = 1e4)

theory <- 
  tibble(x= seq(0,2, length.out = 100)) %>%
  mutate(g = x * p$r * (1 - x / p$K), 
         c = p$a * x ^ p$Q / (x^p$Q + p$H^p$Q)) %>%
  mutate(potential = - cumsum(g - c)) %>%
  gather(curve, y, -x, -potential) 


p1 <- read_csv("../appendixA/noisy_switch.csv")  %>%
  ggplot(aes(t,x)) + 
  geom_line(lwd=.1, col=colours[[1]]) +
  labs(subtitle = bquote(bold(A.)))

p2 <-  theory %>%
  ggplot(aes(x, y, col=curve)) +
  geom_line(lwd=1) + 
  scale_color_ptol() + 
  labs(x = bquote(X[t]), y = bquote(X[t+1]), subtitle= bquote(bold(B.))) +
  theme(legend.position="top")

p3 <-  theory %>%
  ggplot(aes(x, potential)) + 
  geom_line(col=colours[1], lwd=1) + 
  coord_cartesian(xlim=c(0,1.6), ylim=c(-1.15,-0.9)) + 
  labs(subtitle = bquote(bold(C.)))


gridExtra::grid.arrange(p1,p2,p3, layout_matrix = rbind(c(1,1), c(2,3)))
```


Despite the nearly ubiquitous association of a ball-in-cup model
with ecological discussions of resilience and stability, this
potential well diagram (Figure \ref{noisy_switch}C) is also a source of confusion
on the topic.  As we have seen, the most salient feature of this
diagram is the depth of each well: transition probabilities (under
small noise) depend only on the depth of the well and not the
steepness of the well, the distance between the wells or between
well and tipping point barrier.  However, it is important to remember
that because the potential function is defined by the above integral,
it in fact already combines two more elementary and mechanistically
precise quantities from the growth equation: the slope of the growth
rate (stability) and the distance to the tipping point (size of the
basin of attraction).  Both a steeper negative slope or a longer
distance to integrate over between stable and unstable points will
create a deeper well.

Empirical evidence for stochastic switching in ecological timeseries
is limited by the long time scale usually required 
[but see @Keeling2001; @Clements2016; @Clements2017]. Because a single
stochastic transition between alternative stable states appears as
such a dramatic deviation from the previous pattern (as illustrated
in Figure \ref{noisy_switch}A), it is often tempting to assume the change could only
be the result of some sudden external force or change in the
environment, so it is worth remembering that given long enough,
these transitions can happen entirely by chance stochasticity
[@Boettiger2012; @Drake2013]. However, these transitions are most
likely to observed in systems with relatively shallow potential
wells.  This is mostly likely to occur of some external change is
slowly making the potential well shallower and thus transitions
more likely -- a phenomenon that has become to be known as "flickering"
and suggested as a potential early warning sign of an approaching
transition [@Brock2010].  Examples of flickering between alternative
stable states have been suggested in data ranging from geological
timescales at the end of glaciation in the Pleistocene [@Taylor1993]
to ecological scales over a few decades in lake ecosystems [@Wang2012].
Stochastic transitions between bi-stable states are thought to play
an important role in genetic switches, where among other phenomena
this mechanism can explain the emergence of two alternative phenotypes
in clonal microbial populations, which can act to buffer the
population in a changing environment  [@Balaban2004].

<!--
**Further examples**
- @Read2007  Stochasticity generates an evolutionary instability for infectious disease 
- Spatial pattern formation: Turning patterns found in plankton-herbivore dynamics [@Levin1976]

-->

# Noise the informer: Noise can provide novel information

One of the most interesting aspects of noise is as a source of
additional information.  This can be realized in a variety of ways.
For instance, in deriving expressions for the variance created by
demographic noise above, we observed that different partitions of
a logistic growth model can lead to the same macroscopic dynamics
(same values for $b$ - $d$), while having different variance (due
to different values for $b$+$d$).  This suggests that the variation
observed in such a population could potentially help resolve
how dynamics are partitioned between individual birth and death
rates (though in practice one would have to first account for any
contribution of environmental noise).

<!-- fixme need more background? --> 


<!-- Figure 4: Early warning signals -->
```{r tipping, fig.width=7, fig.height=7, fig.cap="Early warning signs of a critical transition in a simulation of increasing serial dilution of budding yeast.  Panel A: Rolling variance   autocorrelation Time series is shown in panel C. Model details and simulation parameters in Appendix A. \\label{tipping}"}
tipping <- read_csv("../appendixA/tipping.csv") 

p1 <- tipping %>%
  select(-x) %>%
  rename("A. autocorrelation" = autocorrelation, "B. variance" = variance) %>%
  gather(series, value, -t, -tip_time) %>%
  ggplot(aes(t, value)) + geom_line(col=colours[[1]]) + 
  geom_vline(aes(xintercept = tip_time), col=colours[[2]], lty=2) +
  facet_wrap(~series, ncol = 2, scales="free_y")  
p2 <- tipping %>% 
  select(t, population = x, tip_time) %>%
  ggplot(aes(t, population)) + geom_line(col=colours[1]) + 
  geom_vline(aes(xintercept = tip_time), col=colours[2], lty=2) + 
  #scale_y_log10()  + 
  labs(subtitle = "C. Yeast population size", 
       caption = "Vertical red dashed line indicates tipping point location")

gridExtra::grid.arrange(p1,p2, layout_matrix = rbind(c(1,1), c(2,2)))

```



Noise can provide novel information in other ways as well.  Stochastic
fluctuations act like a continual miniature perturbation experiment,
constantly pushing a system away from an equilibrium to reveal its
behavior elsewhere in state space. Observing the size and
auto-correlation of these fluctuations thus provides insight on the
stability of an equilibrium point, (as can be seen, for instance
in the fluctuation-dissipation result we found for generic birth
death models).  This observation has been exploited with particular
success as a potential *early warning sign* that a system is loosing
stability; possibly due to an approaching catastrophic transition
or saddle-node bifurcation.  This pattern, known as critical slowing
down (in reference to the auto-correlation time in the physics
literature) was first proposed an an early warning sign for ecological
systems by @Wissel1984, but has received considerable empirical as
well as theoretical attention only more recently [@Scheffer2009;
@Scheffer2015].  Increases in two of these early warning indicators,
variance and auto-correlation, are illustrated along with the
timeseries of a simulation of the dynamics of yeast population
growth in Figure \ref{tipping}.  This simulation is based on a mechanistic model
developed by @Dai2012 that closely matches the population dynamics
they observed in serial dilutions of budding yeast _Saccharomyces
cerevisiae_ on a sucrose medium. Because the relevant proteins are
located in the extra-cellular matrix rather than inside the cells,
budding yeast break down sucrose collaboratively, creating an Allee
effect below which the population is too small to sustain itself.
Increasing the serial dilution rate slowly over time drives the
stable population towards a fold bifurcation, which is accompanied
by the patterns of increasing variance and increasing auto-correlation
seen empirically in lab populations [@Dai2012] as well as the
numerical simulation shown in Figure \ref{tipping}.

As we saw in the equations from the system-size approximation, the
variance and auto-correlation in question are technically properties
of an ensemble, and should be computed over replicate simulations.
While the laboratory experiments of @Dai2012 do precisely this,
conducting identical, independent replicate manipulations in separate
beakers, this is not an option in natural populations.  If the
environmental change is sufficiently slow relative to the measurements,
one can assume that the system is close to its stationary state
over a given window in time, computing these averages over a rolling
time window as we illustrate here, rather than across an ensemble
of replicates.

The challenge of identifying warning signs that a system is approaching
a tipping point has proven a rich area for applications of stochastic
processes.  We have already seen how in addition to the patterns of
increasing variance and auto-correlation, our survey of stochastic phenomena
has highlighted the increased potential to observe stochastic switching,
or flickering, as the system approaches the tipping point.  Challenges remain
in distinguishing these patterns from other causes [@Boettiger2013a].
For instance, as we have seen, variance in a system can increase due to
external drivers without changing the auto-correlation, and both variance
and auto-correlation can increase if a system loses stability without
approaching a saddle-node bifurcation, but will not show flickering.
The greater our suite of stochastic indicators, the better our ability
to pin down the processes involved.  Such examples suggest
that stochastic processes could play a similar role in identifying
other critical transitions. For instance, stochastic resonance may be 
visible in advance of a Hopf bifurcation, where a stable state gives
way to stable oscillations (limit cycle) of growing magnitude
[e.g. @Fussmann2000; @Strogatz2001].

Most importantly, the framing of stochastic processes as indicators of
changes in an ecosystem that might otherwise go unnoticed has proven a
rich catalyst for bringing these concepts beyond the realm of abstract
theory. A rich array of experimental and observational tests of early
warning signals [_i.e._ @Carpenter2011; @Dai2012; @Clements2016; @Clements2017;
and many others, _e.g._ see @Scheffer2015 review] has served no merely
to illustrate these phenomena can be seen in laboratory and field ecosystems,
but also to spark suggestions of additional possible indicators and surface
a wide array of practical [@Boettiger2013b; @Scheffer2015], statistical
[e.g. @Boettiger2012d; @Boettiger2012], and theoretical [e.g. @Dai2015;
@Hastings2010] challenges to such application.  This creates a two-way dialog
between empirical and theoretical work that does much to advance the field
as a whole.


# Conclusions

The past two decades have seen widespread recognition of the central
role that stochasticity plays through the use of mechanistic models
can have in creating and understanding ecological phenomena
[@Coulson2004; @Black2012]. We have seen increasing use of
master-equation approaches to individual-based models to reflect
demographic stochasticity that is amenable to analytical treatment
[@Black2012], and much work in understanding the importance of
environmental noise, particularly the more realistic but less
mathematically convenient notion of colored or auto-correlated noise
on population dynamics, persistence, and coexistence [@Ovaskainen2010;
@Schreiber2017].  These deductive models can generate phenomena
that resemble familiar patterns such as population cycles for which
we have previously sought deterministic explanations, as well as
stochastic phenomena with no such analog such as stochastic switching.
Yet too many of these advances have remained limited to the domain
of theory; limited to deductive models which may seek to mimic
observed patterns but are rarely used to confront empirical data
directly.  There is good reason for this: statistical inference of
even relatively simple models with multiple sources of noise will
always be difficult given limited ecological data [@Knape2011].
However, many stochastic phenomena may suggest new ways to infer
rather than merely obscure underlying processes.


The eruption of interest in early warning signals for critical
transitions [@Scheffer2009] provides an excellent illustration of
this potential.  A range of stochastic phenomena have been suggested
and tested for their potential to reveal subtle signs of ecosystem
change prior to a dramatic shift, and prompted a rich dialog between
further theory and new experiment. Changes in stochastic properties
such as variance or auto-correlation provide evidence of resilience
loss that would be invisible to a deterministic model, and non-linear
stochastic phenomena such as stochastic switching are observed as
evidence of 'flickering' prior to a critical transition.  In this
way, our understanding of stochastic dynamics is translated into
novel sources of information about a system which has sparked a
wealth of empirical investigation and further theoretical work to
test the potential of this approach.  The study and application of
stochastic phenomena to detect ecosystem change is unlikely to be
limited to this simple scenario of a critical transition or fold
bifurcation.

Precisely because most stochastic phenomena arise through their
interaction with non-linearity, the patterns that result can become
a lens into better understanding those nonlinear processes and
detecting how they may change.  Meanwhile, the widespread adoption
of computational tools and the ability to express theoretical results
in numerical algorithms can make any new approaches more readily
accessible to application in empirical research. In the past two
decades, we have set to rest those deterministic skeletons that see
noise only as nuisance and embraced the central role noise plays
as the creator of ecological phenomena. Going forward, I hope and
predict that we will see greater discussion and use of stochastic
phenomena to infer underlying processes in empirical patterns in
similar interactions between theoretical and empirical research.



# References

